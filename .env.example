# ============================================================
# NeverDown — Complete Environment Configuration
# Copy this file to .env and fill in your values
# ============================================================

# ── Application ──────────────────────────────────────────────
APP_NAME=NeverDown
APP_VERSION=1.0.0
DEBUG=true
LOG_LEVEL=INFO

# ── API Server ───────────────────────────────────────────────
API_HOST=0.0.0.0
API_PORT=8000
API_PREFIX=/api/v1
API_KEY=                          # Leave blank to skip auth in dev

# ── Database (PostgreSQL — required) ─────────────────────────
DATABASE_URL=postgresql+asyncpg://neverdown:neverdown@localhost:5432/neverdown
DATABASE_POOL_SIZE=5
DATABASE_MAX_OVERFLOW=10

# ── GitHub (PAT — secondary fallback) ────────────────────────
GITHUB_TOKEN=ghp_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
GITHUB_CLIENT_ID=Ov23li_xxxxxxxxxx
GITHUB_CLIENT_SECRET=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
GITHUB_WEBHOOK_SECRET=your-webhook-secret-here

# ── GitHub App (PRIMARY — developer-owned) ───────────────────
# 1. Create a GitHub App at https://github.com/settings/apps
# 2. Permissions needed: Contents (R+W), Pull Requests (R+W),
#    Actions (R), Checks (R), Metadata (R)
# 3. Set callback URL: https://your-domain/api/v1/github-app/callback
# 4. Generate a private key (.pem file) and put it in the project root
GITHUB_APP_ID=2902214                         # App ID (number from settings)
GITHUB_APP_PRIVATE_KEY=                        # Inline PEM key (or use PATH below)
GITHUB_APP_PRIVATE_KEY_PATH=./neverdown-app.pem # Path to .pem file
GITHUB_APP_SLUG=neverdown-ci-healer            # App slug (from URL: github.com/apps/<slug>)
GITHUB_APP_CLIENT_ID=Iv23lim4aTwlrOAx55dB      # App's OAuth Client ID
GITHUB_APP_CLIENT_SECRET=                      # App's OAuth Client Secret
GITHUB_APP_WEBHOOK_URL=http://localhost:8000/api/v1/github-app/callback

# ── LLM Configuration (Used ONLY by Agent 2 — Reasoner) ─────
LLM_PROVIDER=anthropic            # "anthropic" or "openai"
LLM_API_KEY=sk-ant-api03-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
LLM_MODEL=claude-sonnet-4-20250514
LLM_MAX_TOKENS=4096
LLM_TEMPERATURE=0.1

# ── Docker Sandbox (Agent 3 — Verifier) ─────────────────────
SANDBOX_IMAGE=python:3.11-slim
SANDBOX_TIMEOUT=300
SANDBOX_TIMEOUT_SECONDS=600
SANDBOX_MEMORY_LIMIT=512m
SANDBOX_CPU_LIMIT=1.0
SANDBOX_NETWORK_DISABLED=true

# ── Agent Configuration ──────────────────────────────────────
MAX_RETRIES=5                     # Max fix-verify iterations (default 5)
REASONER_CONFIDENCE_THRESHOLD=0.7
SANITIZER_CONFIDENCE_THRESHOLD=0.9
SANITIZER_MAX_SECRETS=100

# ── Frontend ─────────────────────────────────────────────────
FRONTEND_URL=http://localhost:5173

# ── Paths ────────────────────────────────────────────────────
CLONE_DIR=/tmp/neverdown-clones
SANITIZED_REPO_DIR=/tmp/neverdown-sanitized
RESULTS_DIR=/tmp/neverdown-results
WORKSPACE_DIR=/tmp/neverdown-workspaces

# ── Security ─────────────────────────────────────────────────
ALLOWED_REPOS=                    # Comma-separated list; blank = allow all
REDACTION_PATTERNS_FILE=config/security_rules.yaml
